ARP는 네트워크 계층 주소(예: 인터넷 IP 주소)를 물리 주소 (예: 이더넷 하드웨어, 즉 어댑터 주소 또는 MAC 주소)로
변환하기 위해 사용된다.

인터넷 상에서 호스트 간의 전송은 IP 주소를기반으로 이루어진다. 송신 호스트는 수신 호스트의 IP 주소를 이용해 
데이터 송신을 시도한다. 이때 실제 송신 호스트의 송신 어댑터에서는 IP 패킷을 포함하고 있는 링크 계층 프레임을 구성한다.
링크 계층은 하나의 노드(네트워크에 연결된 하나의 컴퓨터 혹은 장비)와 다음 노드 사이의 데이터 전송을 담당한다.
링크 계층 프레임은 IP주소가 아닌 목적지의 MAC 주소를 포함해야 한다. 이를 위해 송신 호스트는 자신의 네트워크 어댑터 내의
ARP 모듈에게 목적지의 IP 주소에 대해 질의하고 ARP 모듈은 이에 대응하는 MAC 주소로 응답한다.

각각의 호스트 및 라우터는 목적지 호스트에 대한 MAC 주소를 알아내기 위해 매번 ARP 질의 패킷을 구성하여 IP주소에
해당하는 물리 주소 변환을 요청할 수 있다. 하지만 이러한 작업은 네트워크에 많은 부하를 발생시키므로 대부분 네트워크
어댑터의 메모리 내에 ARP 캐시 테이블을 유지하고 있다. 이 테이블은 [IP 주소, MAC 주소 TTL]의 세 가지 항목을 포함한다.
TTL(Time-To-Live) 값은 각각의 IP주소 - MAC 주소 간 매핑이 언제 삭제 되는지를 나타내는 값이다.
테이블의 크기는 제한되어 있는 반면, 통신할 목적지 IP 주소는 대단히 많기 때문에 모든 주소에 대해 MAC 주소 매핑을
유지할 수 없다. 또한 네트워크 기기의 IP주소가 때때로 변경될 수 있으므로 이를 반영할 수 있도록 ARP 프로토콜은 일반적으로 
TTL 값이 지난 엔트리를 제거하여 테이블의 내용을 새로이 갱신한다.

송신 호스트는 전송하고자 하는 수신 호스트의 IP 주소에 대한 MAC 주소를 ARP 테이블로부터 찾아 이를 이용해 
데이터그램(네트워크 계층 패킷)을 구성한다. 만약 ARP 테이블에 목적지에 대한 매핑 엔트리가 없다면, 이 경우 송신 노드는
ARP 프로토콜을 사용하여 ARP 질의 패킷을 구성한다. ARP 패킷은 송신 및 수신 호스트의 IP 주소와 MAC 주소를 포함하는
필드를 가진다. 송신 호스트는 자신의 어댑터에게 MAC 브로드 캐스트 주소 (FF-FF-FF-FF-FF-FF)로 arp 질의 패킷을
전송하도록 하여 서브넷 상의 모든 호스트 및 라우터에게 목적지 ip 주소에 해당하는 MAC 주소에 대해 질의한다.
서브넷 상의 모든 호스트들은 이 ARP 질의 패킷을 수신한 후 , 자신의 ARP 모듈로 전달한다. 각각의 ARP 모듈은
질의 패킷 내의 목적지 IP 주소가 자신과 일치하는지 검사한 후, 일치한다면 자신의 MAC 주소를 포함한 ARP 응답 패킷을
돌려보낸다. 송신 호스트는 이 목적지 MAC 주소를 이용해 자신의 ARP 테이블을 수정한다.
그 후 테이블 내의 IP 주소 - MAC 주소의 매핑 정보를 이용해 IP 패킷을 전송한다.

---------------

동일 네트워크 ARP 동작 과정

1.호스트 A가 자신의 네트워크 어댑터 내의 ARP 캐시 테이블을 체크한다.

2. ARP 질의 패킷이 브로드캐스트된다. (ARP 질의 패킷 : IP 주소가 192.168.1.12 인 호스트 MAC의 주소는?)

3. 호스트 B는 ARP 응답 패킷을 호스트 A로 전송한다.

4. 호스트 A는 ARP 응답 패킷 주소를 이용해 자신의 ARP 캐시 테이블을 수정한다.


---------------


ARP는 동일한 서브넷 (라우터를 거치지 않은 분리된 네트워크) 상에 있는 호스트나 라우터 인터페이스의 IP 주소에 대해서만
주소 변환을 제공한다. 즉, 다른 서브넷 상의 IP 주소에 대응하는 물리 주소를 알아내고자 한다면 ARP는 오류 메시지를
반환한다. 따라서 송신 호스트가 라우터 외부의 다른 서브넷 상의 호스트로 데이터 패킷을 전송하고자 하는 경우 내부적으로
다음과 같이 처리된다. 송신 호스트가 서브넷 상의 라우터의 MAC 주소를 이용하여 송신자로부터 목적지로의 경로 상에 있는
첫 번째 라우터로 우선 전달된다. 패킷을 수신한 라우터는 포워딩 기능을 이용해 이를 목적지 서브넷 상으로 전달하며,
ARP 프로토콜을 이용하여 최종 목적지의 MAC 주소를 알아내 패킷을 구성한 후 목적지 호스트로 전송한다.





---------------

외부 네트워크 ARP 동작 과정

1.서브넷 1의 호스트 A가 서브넷 2의 호스트 B로 IP 패킷을 전송하고자 한다.

2. 호스트 A는 ARP를 이용하여 R의 MAC 주소를 얻는다.

3. R의 MAC 주소를 이용하여 호스트 A-B 간의 IP 패킷을 포함한 링크 계층 프레임을 만든다.

4. A의 네트워크어댑터에서 전송한 프레임을 R에서 수신한다.

5. R은 ARP를 이용하여 B의 MAC 주소를 얻은 후 A로 부터 수신한 패킷을 B로 전송한다.


---------------





------------------------------------------------------------------------------------------------------------------------

http://terms.naver.com/entry.nhn?docId=2271905&cid=51207&categoryId=51207

네트워크 환경에서 임의의 호스트가 다른 호스트에 데이터를 전송하려면 수신 호스트의 IP 주소 뿐만 아니라,
MAC 주소도 알아야 한다. 수신 호스트의 IP 주소는 보통 응용 프로그램을 실행하는 과정에서 직접 입력하므로,
IP 주소로부터 수신 호스트 MAC 주소를 얻는 작업이 추가로 필요하다



[MAC 주소]

송신 호스트가 물리 계층을 통해 데이터를 전송하는 과정에서 필요한 주소를 설명한다. IP 프로토콜 헤더에서
필요한 송신 호스트 IP 주소 , 수신 호스트 IP 주소와 함께 MAC 계층에서도 송신 호스트 MAC 주소 , 수신 호스트
MAC 주소가 필요하다. 송신 호스트의 IP 주소는 자신의 하드 디스크에 보관되어 있으므로 손쉽게 구할 수 있다.
또한 수신 호스트의 IP 주소는 사용자가 접속하고자 하는 호스트의 IP 주소를 지정해 준다. 사용자는 일반적으로 도메인
이름을 입력하는데, 도메인 이름은 DNS 서비스를 통해 IP 주소로 쉽게 변환할 수 있다.


MAC 주소의 경우 송신 호스트 MAC 주소는 자신의 LAN 카드에 내장되므로 이 값을 읽으면 된다. 문제는 수신
호스트 MAC 주소다. 송신 호스트의 내부 정보로는 얻을 수 없다. 따라서 수신 호스트의 IP 주소를 매개변수로 하여
ARP 기능을 통해 수신 호스트 MAC 주소를 얻어야 한다.

IP주소로부터 MAC 주소를 얻는 기능은 ARP(Address Resolution Protocol)를 통해 이루어진다. 예를들어,
호스트 A가 호스트 B의 MAC 주소를 얻으려면 ARP request라는 특수 패킷을 브로드캐스팅 해야한다.
ARP request 패킷을 네트워크의 모든 호스트가 수신하지만, 관계없는 호스트는 패킷을 무시하고 호스트 B만 IP주소가
자신의 IP 주소와 동일함을 인지한다. 따라서 호스트 B는 ARP reply 패킷을 사용해 자신의 MAC 주소를 호스트 A에 회신한다.

데이터를 전송할 때마다 ARP를 사용하여 패킷을 브로드캐스팅하면 네트워크 트래픽이 증가한다. 따라서 ARP를 사용하는
호스트에서는 가장 최근에 얻은 IP 주소와 MAC 주소 매핑 값을 보관하는 캐시 정보를 이용한다. 또한 송신 호스트가
ARP request 패킷을 브로드캐스팅하는 과장에서 패킷을 수신한 모든 호스트는 송신 호스트 IP 주소와 MAC 주소 매핑 값을
자동으로 얻을 수 있다. 이와 같은 방식으로 ARP 트래픽에 의한 네트워크 부하를 최소화할 수 있다.



[RARP]

앞서 언급한 것처럼 ARP는 IP 주소를 이용해 해당 호스트의 MAC 주소를 제공하는 역할을 한다. 이와 유사한 기능을 수행하는
프로토콜인 RARP(Reverse Address Resolution Protocol)는 반대롤 MAC 주소를 이용해 IP주소를 제공한다.

디스크가 존재하지 않는 시스템이나 X원도우 터미널 등에서는 자신의 LAN 카드 정보를 읽어 MAC주소를 얻을 수 있지만,
파일시스템이 없으므로 IP주소를 보관할 방법이 없다. 이런 경우 자신의 MAC 주소와 IP 주소의 매핑 값을 보관하는
호스트로부터 IP 주소를 얻어야 한다.

IP 주소를 얻고자 하는 호스트에서는 MAC 주소를 매개변수로 하여 패킷을 브로드캐스팅한다. 보통 네트워크에서는 RARP의
기능을 전담으로 수행하는 서버가 하나 이상 존재한다.
따라서 모든 호스트가 RARP 변환 요청을 받아도 해당 정보를 보관하고 있는 RAPR 서버만 응답을 수행할 수 있다.

디스크가 존재하지 않는 시스템에서는 위와 같은 기능을 통해 자신의 IP 주소를 얻은 다음, 미리 정해진 호스트로부터
자신의 부트 이미지(예:시스템 운영체제)를 다운로드 받는다. 따라서 이러한 시스템은 ROM 등의 비활성 메모리에 다른
호스트와 통신하여 필요한 부트 이미지를 수신할 수 있는 TFTP등의 기본 프로토콜이 존재한다.








